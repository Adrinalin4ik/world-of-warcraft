{"version":3,"file":"storm-lib.js","names":["_ffiNapi","_interopRequireDefault","require","_refNapi","_refStructNapi","obj","__esModule","_ref$types","ref","types","bool","int32","uint32","string","CString","voidPtr","refType","FixedString","length","size","alignment","indirection","name","get","buffer","offset","readCString","FIND_DATA","Struct","filename","hashIndex","blockIndex","fileSize","fileFlags","compSize","fileTimeLo","fileTimeHi","locale","exports","HANDLE","HANDLEPtr","LPDWORD","_default","ffi","Library","SFileGetLocale","SFileSetLocale","SFileOpenArchive","SFileCreateArchive","SFileCloseArchive","SFileOpenPatchArchive","SFileIsPatchedArchive","SFileHasFile","SFileOpenFileEx","SFileGetFileSize","SFileSetFilePointer","SFileReadFile","SFileCloseFile","SFileGetFileName","SFileExtractFile","SFileFindFirstFile","SFileFindNextFile","SFileFindClose","GetLastError"],"sources":["../../src/lib/mpq/storm-lib.js"],"sourcesContent":["import ffi from 'ffi-napi';\nimport ref from 'ref-napi';\nimport Struct from 'ref-struct-napi';\n\nconst { bool, int32, uint32 } = ref.types;\nconst string = ref.types.CString;\n\nconst voidPtr = ref.refType(ref.types.void);\n\nconst FixedString = function(length) {\n  return {\n    size: length,\n    alignment: length,\n    indirection: 1,\n    name: 'pointer',\n    get: function(buffer, offset) {\n      return buffer.readCString(offset);\n    }\n  };\n};\n\nconst FIND_DATA = Struct({\n  filename:   FixedString(1024),\n  name:       string,\n  hashIndex:  uint32,\n  blockIndex: uint32,\n  fileSize:   uint32,\n  fileFlags:  uint32,\n  compSize:   uint32,\n  fileTimeLo: uint32,\n  fileTimeHi: uint32,\n  locale:     uint32\n});\n\nconst HANDLE = voidPtr;\nconst HANDLEPtr = ref.refType(HANDLE);\n\nconst LPDWORD = voidPtr;\n\nexport default new ffi.Library('libstorm', {\n\n  SFileGetLocale: [uint32, []],\n\n  SFileSetLocale: [uint32, [\n    uint32\n  ]],\n\n  SFileOpenArchive: [bool, [\n    string,\n    uint32,\n    uint32,\n    HANDLEPtr\n  ]],\n\n  SFileCreateArchive: [ref.types.char, [\n    string,\n    uint32,\n    uint32,\n    HANDLEPtr\n  ]],\n\n  // SFileCreateArchive2: [ref.types.char, [\n  //   TCHARPtr,\n  //   _SFILE_CREATE_MPQPtr,\n  //   HANDLEPtr\n  // ]]\n  // SFileSetDownloadCallback: [ref.types.char, [\n  //   HANDLE,\n  //   SFILE_DOWNLOAD_CALLBACK,\n  //   voidPtr\n  // ]]\n  // SFileFlushArchive: [ref.types.char, [\n  //   HANDLE\n  // ]]\n\n  SFileCloseArchive: [bool, [\n    HANDLE\n  ]],\n\n  // SFileAddListFile: [ref.types.int32, [\n  //   HANDLE,\n  //   ref.types.CString\n  // ]]\n\n  // SFileSetCompactCallback: [ref.types.char, [\n  //   HANDLE,\n  //   SFILE_COMPACT_CALLBACK,\n  //   voidPtr\n  // ]]\n\n  // SFileCompactArchive: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.CString,\n  //   ref.types.char\n  // ]]\n\n  // SFileGetMaxFileCount: [ref.types.uint32, [\n  //   HANDLE\n  // ]]\n\n  // SFileSetMaxFileCount: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileGetAttributes: [ref.types.uint32, [\n  //   HANDLE\n  // ]]\n\n  // SFileSetAttributes: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileUpdateFileAttributes: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.CString\n  // ]]\n\n  SFileOpenPatchArchive: [bool, [\n    HANDLE,\n    string,\n    string,\n    uint32\n  ]],\n\n  SFileIsPatchedArchive: [bool, [\n    HANDLE\n  ]],\n\n  SFileHasFile: [bool, [\n    HANDLE,\n    string\n  ]],\n\n  SFileOpenFileEx: [bool, [\n    HANDLE,\n    string,\n    uint32,\n    HANDLEPtr\n  ]],\n\n  SFileGetFileSize: [uint32, [\n    HANDLE,\n    LPDWORD\n  ]],\n\n  SFileSetFilePointer: [uint32, [\n    HANDLE,\n    int32,\n    int32,\n    uint32\n  ]],\n\n  SFileReadFile: [bool, [\n    HANDLE,\n    voidPtr,\n    uint32,\n    LPDWORD,\n    voidPtr\n  ]],\n\n  SFileCloseFile: [bool, [\n    HANDLE\n  ]],\n\n  // SFileGetFileInfo: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.uint32,\n  //   voidPtr,\n  //   ref.types.uint32,\n  //   LPDWORD\n  // ]]\n\n  SFileGetFileName: [bool, [\n    HANDLE,\n    voidPtr\n  ]],\n\n  // SFileFreeFileInfo: [ref.types.char, [\n  //   voidPtr,\n  //   ref.types.uint32\n  // ]]\n\n  SFileExtractFile: [bool, [\n    HANDLE,\n    string,\n    string,\n    uint32\n  ]],\n\n  // SFileGetFileChecksums: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.CString,\n  //   LPDWORD,\n  //   ref.types.CString\n  // ]]\n\n  // SFileVerifyFile: [ref.types.uint32, [\n  //   HANDLE,\n  //   ref.types.CString,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileVerifyRawData: [ref.types.int32, [\n  //   HANDLE,\n  //   ref.types.uint32,\n  //   ref.types.CString\n  // ]]\n\n  // SFileVerifyArchive: [ref.types.uint32, [\n  //   HANDLE\n  // ]]\n\n  SFileFindFirstFile: [HANDLE, [\n    HANDLE,\n    string,\n    voidPtr,\n    string\n  ]],\n\n  SFileFindNextFile: [bool, [\n    HANDLE,\n    voidPtr\n  ]],\n\n  SFileFindClose: [bool, [\n    HANDLE\n  ]],\n\n  // SListFileFindFirstFile: [HANDLE, [\n  //   HANDLE,\n  //   ref.types.CString,\n  //   ref.types.CString,\n  //   SFILE_FIND_DATAPtr\n  // ]]\n\n  // SListFileFindNextFile: [ref.types.char, [\n  //   HANDLE,\n  //   SFILE_FIND_DATAPtr\n  // ]]\n\n  // SListFileFindClose: [ref.types.char, [\n  //   HANDLE\n  // ]]\n\n  // SFileEnumLocales: [ref.types.int32, [\n  //   HANDLE,\n  //   ref.types.CString,\n  //   LCID,\n  //   LPDWORD,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileCreateFile: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.CString,\n  //   ref.types.ulonglong,\n  //   ref.types.uint32,\n  //   ref.types.uint32,\n  //   ref.types.uint32,\n  //   HANDLEPtr\n  // ]]\n\n  // SFileWriteFile: [ref.types.char, [\n  //   HANDLE,\n  //   voidPtr,\n  //   ref.types.uint32,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileFinishFile: [ref.types.char, [\n  //   HANDLE\n  // ]]\n\n  // SFileAddFileEx: [ref.types.char, [\n  //   HANDLE,\n  //   TCHARPtr,\n  //   ref.types.CString,\n  //   ref.types.uint32,\n  //   ref.types.uint32,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileAddFile: [ref.types.char, [\n  //   HANDLE,\n  //   TCHARPtr,\n  //   ref.types.CString,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileAddWave: [ref.types.char, [\n  //   HANDLE,\n  //   TCHARPtr,\n  //   ref.types.CString,\n  //   ref.types.uint32,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileRemoveFile: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.CString,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileRenameFile: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.CString,\n  //   ref.types.CString\n  // ]]\n\n  // SFileSetFileLocale: [ref.types.char, [\n  //   HANDLE,\n  //   ref.types.uint32\n  // ]]\n\n  // SFileSetDataCompression: [ref.types.char, [\n  //   ref.types.uint32\n  // ]]\n\n  // SFileSetAddFileCallback: [ref.types.char, [\n  //   HANDLE,\n  //   SFILE_ADDFILE_CALLBACK,\n  //   voidPtr\n  // ]]\n\n  // SCompImplode: [ref.types.int32, [\n  //   voidPtr,\n  //   ref.refType(ref.types.int32),\n  //   voidPtr,\n  //   ref.types.int32\n  // ]]\n\n  // SCompExplode: [ref.types.int32, [\n  //   voidPtr,\n  //   ref.refType(ref.types.int32),\n  //   voidPtr,\n  //   ref.types.int32\n  // ]]\n\n  // SCompCompress: [ref.types.int32, [\n  //   voidPtr,\n  //   ref.refType(ref.types.int32),\n  //   voidPtr,\n  //   ref.types.int32,\n  //   ref.types.uint32,\n  //   ref.types.int32,\n  //   ref.types.int32\n  // ]]\n\n  // SCompDecompress: [ref.types.int32, [\n  //   voidPtr,\n  //   ref.refType(ref.types.int32),\n  //   voidPtr,\n  //   ref.types.int32\n  // ]]\n\n  // SCompDecompress2: [ref.types.int32, [\n  //   voidPtr,\n  //   ref.refType(ref.types.int32),\n  //   voidPtr,\n  //   ref.types.int32\n  // ]]\n\n  GetLastError: [int32, []]\n});\n\nexport { FIND_DATA, HANDLEPtr };\n"],"mappings":"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ACNxB,OAAO,EACPH,MAAM,EACN6B,OAAO,EACP1B,OAAO,CACR,CAAC;EAEF0C,cAAc,EAAE,CAAC/C,IAAI,EAAE,CACrB6B,MAAM,CACP,CAAC;EAEF;EACA;EACA;EACA;EACA;EACA;EACA;;EAEAmB,gBAAgB,EAAE,CAAChD,IAAI,EAAE,CACvB6B,MAAM,EACNxB,OAAO,CACR,CAAC;EAEF;EACA;EACA;EACA;;EAEA4C,gBAAgB,EAAE,CAACjD,IAAI,EAAE,CACvB6B,MAAM,EACN1B,MAAM,EACNA,MAAM,EACND,MAAM,CACP,CAAC;EAEF;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;;EAEAgD,kBAAkB,EAAE,CAACrB,MAAM,EAAE,CAC3BA,MAAM,EACN1B,MAAM,EACNE,OAAO,EACPF,MAAM,CACP,CAAC;EAEFgD,iBAAiB,EAAE,CAACnD,IAAI,EAAE,CACxB6B,MAAM,EACNxB,OAAO,CACR,CAAC;EAEF+C,cAAc,EAAE,CAACpD,IAAI,EAAE,CACrB6B,MAAM,CACP,CAAC;EAEF;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;;EAEA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;;EAEA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEAwB,YAAY,EAAE,CAACpD,KAAK,EAAE,EAAE;AAC1B,CAAC,CAAC;AAAA2B,OAAA,cAAAI,QAAA"}