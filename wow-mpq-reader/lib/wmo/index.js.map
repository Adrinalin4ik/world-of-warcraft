{"version":3,"file":"index.js","names":["r","_interopRequireWildcard","require","_chunked","_interopRequireDefault","_chunk","_paddedStrings","_skipChunk","_types","obj","__esModule","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","MOHD","Chunk","textureCount","uint32le","groupCount","portalCount","lightCount","modelCount","doodadCount","doodadSetCount","ambientColor","Struct","uint8","g","b","a","wmoID","minBoundingBox","Vec3Float","maxBoundingBox","flags","skipBaseColor","MOTX","filenames","PaddedStrings","MOMT","materials","Array","shader","blendMode","textures","offset","color","unknowns","Reserved","MOGN","names","String","MOGI","groups","nameOffset","int32le","indoor","MOSB","skybox","MODS","sets","name","startIndex","unused","MODN","MODD","doodads","filenameOffset","uint24le","filename","parent","position","rotation","Quat","scale","floatle","MFOG","fogs","smallerRadius","largerRadius","fogEnd","fogStartMultiplier","color2","MOPV","vertices","float32array3","MOPT","portals","vertexOffset","uint16le","vertexCount","plane","normal","constant","MOPR","references","portalIndex","groupIndex","side","int16le","unknown1","_default","Chunked","MOVV","SkipChunk","MOVB","MOLT","exports"],"sources":["../../src/lib/wmo/index.js"],"sourcesContent":["import * as r from 'restructure';\n\nimport Chunked from '../chunked';\nimport Chunk from '../chunked/chunk';\nimport PaddedStrings from '../chunked/padded-strings';\nimport SkipChunk from '../chunked/skip-chunk';\nimport { float32array3, Quat, Vec3Float } from '../types';\n\nconst MOHD = Chunk({\n  textureCount: r.uint32le,\n  groupCount: r.uint32le,\n  portalCount: r.uint32le,\n  lightCount: r.uint32le,\n  modelCount: r.uint32le,\n  doodadCount: r.uint32le,\n  doodadSetCount: r.uint32le,\n  ambientColor: new r.Struct({\n    r: r.uint8,\n    g: r.uint8,\n    b: r.uint8,\n    a: r.uint8\n  }),\n  wmoID: r.uint32le,\n  minBoundingBox: Vec3Float,\n  maxBoundingBox: Vec3Float,\n  flags: r.uint32le,\n\n  skipBaseColor: function() {\n    return (this.flags & 0x02) !== 0;\n  }\n});\n\nconst MOTX = Chunk({\n  filenames: new PaddedStrings('size', 'bytes')\n});\n\nconst MOMT = Chunk({\n  materials: new r.Array(new r.Struct({\n    flags: r.uint32le,\n    shader: r.uint32le,\n    blendMode: r.uint32le,\n\n    textures: new r.Array(new r.Struct({\n      offset: r.uint32le,\n      color: new r.Struct({\n        r: r.uint8,\n        g: r.uint8,\n        b: r.uint8,\n        a: r.uint8\n      }),\n      flags: r.uint32le\n    }), 3),\n\n    unknowns: new r.Reserved(r.uint32le, 4)\n  }), 'size', 'bytes')\n});\n\nconst MOGN = Chunk({\n  names: new r.Array(new r.String(null), 'size', 'bytes')\n});\n\nconst MOGI = Chunk({\n  groups: new r.Array(new r.Struct({\n    flags: r.uint32le,\n    minBoundingBox: Vec3Float,\n    maxBoundingBox: Vec3Float,\n    nameOffset: r.int32le,\n\n    indoor: function() {\n      return (this.flags & 0x2000) !== 0 && (this.flags & 0x8) === 0;\n    }\n  }), 'size', 'bytes')\n});\n\nconst MOSB = Chunk({\n  skybox: new r.String('size')\n});\n\nconst MODS = Chunk({\n  sets: new r.Array(new r.Struct({\n    name: new r.String(20),\n    startIndex: r.uint32le,\n    doodadCount: r.uint32le,\n    unused: new r.Reserved(r.uint32le)\n  }), 'size', 'bytes')\n});\n\nconst MODN = Chunk({\n  filenames: new PaddedStrings('size', 'bytes')\n});\n\nconst MODD = Chunk({\n  doodads: new r.Array(new r.Struct({\n    filenameOffset: r.uint24le,\n    filename: function() {\n      return this.parent.parent.MODN.filenames[this.filenameOffset];\n    },\n    flags: r.uint8,\n    position: Vec3Float,\n    rotation: Quat,\n    scale: r.floatle,\n    color: r.uint32le\n  }), 'size', 'bytes')\n});\n\nconst MFOG = Chunk({\n  fogs: new r.Array(new r.Struct({\n    flags: r.uint32le,\n    position: Vec3Float,\n    smallerRadius: r.floatle,\n    largerRadius: r.floatle,\n    fogEnd: r.floatle,\n    fogStartMultiplier: r.floatle,\n    color: r.uint32le,\n    unknowns: new r.Reserved(r.floatle, 2),\n    color2: r.uint32le\n  }), 'size', 'bytes')\n});\n\nconst MOPV = Chunk({\n  vertices: new r.Array(float32array3, 'size', 'bytes')\n});\n\nconst MOPT = Chunk({\n  portals: new r.Array(new r.Struct({\n    vertexOffset: r.uint16le,\n    vertexCount: r.uint16le,\n    plane: new r.Struct({\n      normal: float32array3,\n      constant: r.floatle\n    })\n  }), 'size', 'bytes')\n});\n\nconst MOPR = Chunk({\n  references: new r.Array(new r.Struct({\n    portalIndex: r.uint16le,\n    groupIndex: r.uint16le,\n    side: r.int16le,\n    unknown1: r.uint16le\n  }), 'size', 'bytes')\n});\n\nexport default Chunked({\n  MOHD: MOHD,\n  MOTX: MOTX,\n  MOMT: MOMT,\n  MOGN: MOGN,\n  MOGI: MOGI,\n  MOSB: MOSB,\n  MOPV: MOPV,\n  MOPT: MOPT,\n  MOPR: MOPR,\n  MOVV: SkipChunk,\n  MOVB: SkipChunk,\n  MOLT: SkipChunk,\n  MODS: MODS,\n  MODN: MODN,\n  MODD: MODD,\n  MFOG: MFOG,\n  // TODO: Optional MCVP chunk\n\n  flags: function() {\n    return this.MOHD.flags;\n  }\n});\n"],"mappings":"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"}